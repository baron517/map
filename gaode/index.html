<!-- 重点参数：setIconStyle, setIconLabel -->
<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>首页</title>
    <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_835224_ua83fpjuxk.css">
    <style>
        html,
        body,
        #container {
            width: 100%;
            height: 100%;
            margin: 0px;
            font-family: "Microsoft yahei";
        }
        .amap-logo,.amap-copyright{display: none!important;}
        .amap-marker-label {
            font-size: 13px;
            border: 1px solid orange;
            background: #fff;
            border-radius: 10px 0 0 0;
            color: #690441;
        }

        .tool{position: absolute;width:50px;height:100%;color:#fff;left:0;top:0;z-index:1000;
            text-align:center;background: #323232;}
        .tool .title{padding:5px 0;}
        .tool ul{list-style: none;margin:0;padding:0;}
        .tool ul i{display: block;font-size:20px;}



    </style>
</head>

<body>
<div id="container"></div>

<div class="tool">
    <div class="title">模式</div>

    <ul>
        <li>
            <i class="iconfont icon-shou"></i>
            手动
        </li>
        <li>
            <i class="iconfont icon-24"></i>
            自动
        </li>
    </ul>

    <div class="title">操作</div>
    <ul>
        <li>
            <i class="iconfont icon-jia"></i>
            创建
        </li>
        <li>
            <i class="iconfont icon-baocun"></i>
            保存
        </li>
    </ul>

</div>

<script type="text/javascript" src='//webapi.amap.com/maps?v=1.4.10&key=3eb43430e8b071ba30f8ae473ab4e401&plugin=ElasticMarker'></script>
<script src="js/common.js"></script>
<script src="lib/jquery.js"></script>
<script src="https://unpkg.com/flyio/dist/fly.min.js"></script>
<script src="lib/layer/layer.js"></script>
<script type="text/javascript">
    //创建地图

    var map = new AMap.Map('container', {

        turboMode:false,
        showIndoorMap:false,
        defaultCursor:'pointer',
        zooms:[14,20],
        zoom:18,
        pitch:55,
        center:[121.498672,31.235818],
        forceVector:true
    });

    map.plugin(['AMap.ToolBar'], function() {
        //设置地位标记为自定义标记
        var toolBar = new AMap.ToolBar({position:"RT"});
        map.addControl(toolBar);
    });


    var facilities = [];
    var pointList=[];
    var zoomStyleMapping1 = {
        14:0,
        15:0,
        16:0,
        17:0,
        18:0,
        19:0,
        20:0
    };


    /*var index = layer.load(1, {
        shade: [0.3,'#000'] //0.1透明度的白色背景
    });*/

    fly.get(serverUrl+'get-covers')
            .then(function (response) {
                console.log(response.data.code);
                var data=response.data;
               /* if(data.code==0)
                {
                    pointList=data.data;
                    for(var i=0;i<data.data.length;i++)
                    {
                        var size=data.data[i].diameter/30;

                            var marker = new AMap.ElasticMarker({
                                position:[data.data[i].lon, data.data[i].lat],
                                styles:[{
                                    icon:{
                                        img:"img/famen.png",
                                        size:[size,size],//可见区域的大小
                                        ancher:[8,16],//锚点
                                        fitZoom:14,//最合适的级别
                                        scaleFactor:2,//地图放大一级的缩放比例系数
                                        maxScale:1.4,//最大放大比例
                                        minScale:0.8//最小放大比例
                                    }
                                }],
                                zoomStyleMapping:zoomStyleMapping1
                            });
                        marker.mid=data.data[i].id;
                        AMap.event.addListener(marker, 'click', function(e) {

                            var mid=e.target.mid;
                            console.log(mid);

                        }, false);

                            facilities.push(marker);
                    }

                    map.add(facilities)

                    getAreas();

                }*/

            })
            .catch(function (error) {
                console.log(error);
            });


    //获取点击坐标
    var circlePointList=[];
    map.on('click',function(e){
        console.log(e.lnglat);

        circlePointList.push(e.lnglat);

        var circleMarker = new AMap.CircleMarker({
            center:e.lnglat,
            radius:10+Math.random()*10,//3D视图下，CircleMarker半径不要超过64px
            strokeColor:'white',
            strokeWeight:2,
            strokeOpacity:0.5,
            fillColor:'rgba(0,0,255,1)',
            fillOpacity:0.5,
            zIndex:10,
            bubble:true,
            cursor:'pointer',
            clickable: true
        })
        circleMarker.setMap(map);


    })


    function getAreas()
    {
        fly.get(serverUrl+'get-areas?areatype=2')
                .then(function (response) {
                    console.log(response.data);
                    var data=response.data;

                    if(data.code==0)
                    {
                        for(var i=0;i<data.data.length;i++)
                        {
                            var polygonArr =[];
                            var areaList=data.data[i].covers.split(",");
                            for(var j=0;j<areaList.length;j++)
                            {

                                for(var k=0;k<pointList.length;k++)
                                {

                                    if(areaList[j].toString()==pointList[k].id)
                                    {

                                        polygonArr.push([pointList[k].lon, pointList[k].lat]);
                                        break;
                                    }
                                }

                            }

                            console.log(polygonArr);

                            var  polygon = new AMap.Polygon({
                                path: polygonArr,//设置多边形边界路径
                                strokeColor: "#FF33FF", //线颜色
                                strokeOpacity: 0.8, //线透明度
                                strokeWeight: 5,    //线宽
                                fillColor: "#1791fc", //填充色
                                fillOpacity: 0.35//填充透明度
                            });
                            polygon.setMap(map);

                        }



                    }

                    layer.close(index);

                })
                .catch(function (error) {
                    console.log(error);
                });

    }









</script>
</body>

</html>